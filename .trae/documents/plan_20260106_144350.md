# 1. 修改目标
对infer_photo_quality.py文件进行结构化修改，实现结果文件的规范化存储与管理，包括：
- 结构化的结果文件存储
- 标准化的目录结构
- 完善的异常处理
- 高质量的代码设计

# 2. 详细修改内容

## 2.1 主文件夹命名与创建
- 修改主文件夹命名规则为"评估模型名称+时间戳"，时间戳格式为YYYYMMDD_HHMMSS
- 支持绝对路径和相对路径配置
- 实现路径验证和异常处理

## 2.2 目录结构设计
```
{main_output_dir}/
├── images/
│   ├── good/     # 存储质量良好的照片
│   └── bad/      # 存储质量不佳的照片
├── logs/
│   ├── {timestamp}_results.csv  # CSV格式日志
│   └── {timestamp}_results.json  # JSON格式日志
├── configs/
│   └── config.json  # 推理配置参数
└── summary.txt       # 推理统计摘要
```

## 2.3 核心功能实现

### 2.3.1 目录创建与异常处理
- 实现原子性目录创建
- 添加路径权限、不存在、磁盘空间等异常处理
- 实现幂等性处理，避免重复创建

### 2.3.2 照片分类存储
- 自动创建"good"和"bad"子文件夹
- 实现文件复制/移动功能，保留原始文件名
- 文件名冲突处理机制

### 2.3.3 日志文件生成
- 生成CSV格式日志，包含详细评估记录
- 生成JSON格式日志，包含结构化推理信息
- 日志文件命名包含时间戳

### 2.3.4 配置参数保存
- 保存所有推理配置参数
- 使用JSON格式，添加生成时间和版本信息

### 2.3.5 摘要文件生成
- 包含推理开始/结束时间
- 总处理照片数量
- 好/坏照片数量
- 平均处理时间
- 模型版本信息

## 2.4 代码质量优化
- 使用绝对路径处理所有文件操作
- 模块化设计文件操作代码
- 添加详细注释
- 确保与原有评估逻辑兼容

# 3. 修改后的使用方式
保持原有命令行参数不变，新增结果存储功能：
```bash
python infer_photo_quality.py --model_path <model_path> --input_path <input_path> --output_dir <output_dir>
```

# 4. 测试验证
- 正常流程测试
- 边界条件测试（空文件夹、异常文件名、超大文件等）
- 异常场景测试（磁盘满、权限不足等）